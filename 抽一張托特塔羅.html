<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æŠ½ä¸€å¼µæ‰˜ç‰¹å¡”ç¾…ï¼ŒçŸ¥é“è‡ªå·±ä»Šå¤©çš„é‹å‹¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* å¼•å…¥å¥½çœ‹çš„ä¸­æ–‡å­—é«” */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fff7ed; /* Orange-50 */
            background-image: radial-gradient(#fdba74 2px, transparent 2px);
            background-size: 24px 24px;
            touch-action: manipulation; /* é˜²æ­¢æ‰‹æ©Ÿä¸Šé›™æ“Šç¸®æ”¾ */
        }

        /* è½‰ç›¤å®¹å™¨ï¼šé€™æ˜¯æœƒæ—‹è½‰çš„éƒ¨åˆ† */
        .wheel-container {
            width: 300px;
            height: 300px;
            position: relative;
            border-radius: 50%;
            border: 8px solid #ffffff;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            /* é—œéµï¼šé è¨­éæ¸¡æ•ˆæœï¼Œç¢ºä¿æ—‹è½‰æ™‚æœ‰å‹•ç•« */
            transition: transform 5s cubic-bezier(0.2, 0, 0.1, 1);
        }

        /* è½‰ç›¤ä¸­çš„ Canvas */
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* æŒ‡é‡ */
        .pointer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            filter: drop-shadow(0 4px 2px rgba(0,0,0,0.2));
        }

        /* çµæœå½ˆçª—å‹•ç•« */
        @keyframes pop-in {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: pop-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* é«˜äº®å…‰æšˆå‹•ç•« */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 50px rgba(251, 191, 36, 1); }
        }
        .winner-glow {
            animation: pulse-glow 1s infinite;
            border-color: #fbbf24; /* Amber-400 */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 text-slate-800">

    <div class="bg-white/95 backdrop-blur w-full max-w-md rounded-3xl shadow-2xl p-6 flex flex-col items-center border-t-4 border-orange-400">
        
        <div class="text-center mb-6">
            <h1 class="text-3xl font-black text-orange-600 tracking-tight">ğŸª æŠ½ä¸€å¼µæ‰˜ç‰¹å¡”ç¾…</h1>
            <p class="text-slate-500 text-sm mt-1">çŸ¥é“è‡ªå·±ä»Šå¤©çš„é‹å‹¢</p>
        </div>

        <div class="w-full mb-6 relative group">
            <label class="block text-xs font-bold text-slate-400 uppercase mb-1 ml-1">è¼¸å…¥é¸é … (ç”¨é€—è™Ÿåˆ†éš”)</label>
            <textarea id="optionsInput" 
                class="w-full h-24 p-4 rounded-xl bg-orange-50 border-2 border-orange-100 text-slate-700 font-medium focus:outline-none focus:border-orange-400 focus:ring-4 focus:ring-orange-100 transition-all resize-none placeholder:text-orange-200/80"
                placeholder="æ„šäºº, é­”æ³•å¸«, å¥³ç¥­å¸, å¥³ç‹, å¸ç‹">æ„šäºº, é­”æ³•å¸«, å¥³ç¥­å¸, å¥³ç‹, å¸ç‹, å¤§ç¥­å¸, æˆ€äºº, æˆ°è»Š, èª¿ç¯€, éš±å£«, å‘½é‹, æ…¾æœ›, åŠäºº, æ­»ç¥, è—è¡“, æƒ¡é­”, å¡”, æ˜Ÿæ˜Ÿ, æœˆäº®, å¤ªé™½, æ–°ç´€å…ƒ, å®‡å®™ </textarea>
            <div class="absolute bottom-2 right-2 text-[10px] text-orange-300 font-bold bg-white px-2 py-0.5 rounded-full shadow-sm">
                <span id="itemCount">22</span> å€‹é¸é …
            </div>
        </div>

        <div class="relative mb-8">
            <div class="pointer">
                <svg width="50" height="50" viewBox="0 0 40 40">
                    <path d="M20 40 L5 10 L35 10 Z" fill="#ef4444" stroke="white" stroke-width="3"/>
                </svg>
            </div>

            <div id="wheel" class="wheel-container" style="transform: rotate(0deg);">
                <canvas id="canvas" width="600" height="600"></canvas> </div>

            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center z-10 border-4 border-orange-100">
                <span class="text-2xl">âœ¡ï¸</span>
            </div>
        </div>

        <button id="spinButton" class="w-full py-4 bg-gradient-to-r from-orange-500 to-red-500 rounded-2xl text-white font-black text-xl shadow-lg shadow-orange-200 transform transition hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2">
            <span>GO! é–‹å§‹è½‰å‹•</span>
        </button>

    </div>

    <div id="resultModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-3xl p-8 max-w-xs w-full text-center shadow-2xl transform scale-90 transition-transform duration-300" id="resultCard">
            <div class="text-6xl mb-4 animate-bounce">ğŸ‰</div>
            <h2 class="text-xl font-bold text-slate-500 mb-2">å‘½é‹æ±ºå®š...</h2>
            <div id="resultText" class="text-3xl font-black text-orange-600 leading-tight py-4 border-y-2 border-dashed border-orange-100 my-4">
                </div>
            <button id="closeModal" class="bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-3 px-8 rounded-full transition-colors w-full">
                å»çœ‹è§£ç­”ï¼
            </button>
        </div>
    </div>

    <script>
        // --- è®Šæ•¸è¨­å®š ---
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spinButton');
        const optionsInput = document.getElementById('optionsInput');
        const wheel = document.getElementById('wheel');
        const resultModal = document.getElementById('resultModal');
        const resultCard = document.getElementById('resultCard');
        const resultText = document.getElementById('resultText');
        const closeModal = document.getElementById('closeModal');
        const itemCountLabel = document.getElementById('itemCount');

        // é…è‰²ç›¤ (é«˜é£½å’Œåº¦)
        const colors = ['#FF6B6B', '#4ECDC4', '#FFD93D', '#FF9F43', '#6C5CE7', '#A3CB38', '#F78FB3', '#3DC1D3'];

        let options = [];
        let currentRotation = 0; // ç´€éŒ„ç•¶å‰è§’åº¦ï¼Œé¿å…è½‰ç›¤å€’è½‰
        let isSpinning = false;

        // --- æ ¸å¿ƒå‡½æ•¸ ---

        // 1. è®€å–è¼¸å…¥ä¸¦ç¹ªè£½
        function updateWheel() {
            const text = optionsInput.value;
            // ä»¥é€—è™Ÿæˆ–æ›è¡Œåˆ†å‰²ï¼Œä¸¦éæ¿¾ç©ºå€¼
            options = text.split(/[,ï¼Œ\n]/).map(s => s.trim()).filter(s => s !== "");
            
            // é˜²å‘†ï¼šå¦‚æœæ²’è¼¸å…¥ï¼Œçµ¦é è¨­å€¼
            if (options.length === 0) options = ['éš¨ä¾¿åƒ', 'æ–·é£Ÿ', 'åƒç©ºæ°£'];
            
            itemCountLabel.innerText = options.length;
            draw(options);
        }

        // 2. ç¹ªè£½ Canvas
        function draw(items) {
            const len = items.length;
            const arc = (2 * Math.PI) / len;
            const radius = canvas.width / 2;
            const cx = radius;
            const cy = radius;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = "bold 28px 'Noto Sans TC'"; // å­—é«”æ”¾å¤§
            ctx.textBaseline = "middle";

            for (let i = 0; i < len; i++) {
                const angle = i * arc - (Math.PI / 2); // -90åº¦é–‹å§‹ç•«ï¼Œè®“ç¬¬ä¸€å€‹é¸é …åœ¨æ­£ä¸Šæ–¹

                // ç•«æ‰‡å½¢
                ctx.fillStyle = colors[i % colors.length];
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.arc(cx, cy, radius, angle, angle + arc);
                ctx.lineTo(cx, cy);
                ctx.fill();
                
                // ç•«ç™½ç·šåˆ†éš”
                ctx.strokeStyle = "#ffffff";
                ctx.lineWidth = 4;
                ctx.stroke();

                // ç•«æ–‡å­—
                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#fff";
                ctx.shadowColor = "rgba(0,0,0,0.3)";
                ctx.shadowBlur = 4;
                ctx.fillText(items[i], radius - 30, 0);
                ctx.restore();
            }
        }

        // 3. è½‰å‹•é‚è¼¯ (é—œéµä¿®æ­£)
        function spin() {
            if (isSpinning) return;
            isSpinning = true;
            
            // UI ç‹€æ…‹æ›´æ–°
            spinButton.disabled = true;
            spinButton.innerHTML = `<span class="animate-spin">âŒ›</span> å‘½é‹é‹ç®—ä¸­...`;
            wheel.classList.remove('winner-glow'); // ç§»é™¤èˆŠçš„é«˜äº®

            // è¨ˆç®—è§’åº¦
            // åŸºæœ¬åœˆæ•¸ 5~10 åœˆ (360 * 5)
            // éš¨æ©Ÿè§’åº¦ (0~360)
            const randomDeg = Math.floor(Math.random() * 360);
            const totalDeg = (360 * 8) + randomDeg;
            
            // ç´¯åŠ è§’åº¦ (é€™æ¨£è½‰ç›¤æ‰æœƒä¸€ç›´å¾€åŒä¸€å€‹æ–¹å‘è½‰ï¼Œä¸æœƒå€’å¸¶)
            currentRotation += totalDeg;

            // åŸ·è¡Œ CSS å‹•ç•«
            wheel.style.transform = `rotate(${currentRotation}deg)`;

            // ç­‰å¾… 5 ç§’å‹•ç•«çµæŸ
            setTimeout(() => {
                finishSpin(currentRotation);
            }, 5000);
        }

        // 4. è¨ˆç®—çµæœä¸¦é¡¯ç¤º
        function finishSpin(finalRotation) {
            isSpinning = false;
            spinButton.disabled = false;
            spinButton.innerHTML = `<span>GO! å†è½‰ä¸€æ¬¡</span>`;
            
            // æ•¸å­¸è¨ˆç®—ï¼š
            // è½‰ç›¤è½‰äº† +N åº¦ (é †æ™‚é‡)ã€‚
            // å¯¦éš›åœåœ¨æŒ‡é‡(æ­£ä¸Šæ–¹)çš„é»ï¼Œç›¸ç•¶æ–¼é€†æ™‚é‡èµ°äº† (N % 360) åº¦ã€‚
            // å› ç‚ºæˆ‘å€‘ç¹ªè£½æ™‚ï¼Œç¬¬ä¸€å€‹é¸é …(index 0)æ˜¯å¾ -90åº¦(æ­£ä¸Šæ–¹) é–‹å§‹ç•«çš„ã€‚
            // æ‰€ä»¥é€™æ¯”è¼ƒç°¡å–®ï¼š
            const degrees = finalRotation % 360;
            
            // è¨ˆç®—æ¯ä¸€å¡Šçš„è§’åº¦
            const arcDeg = 360 / options.length;
            
            // è¨ˆç®— index
            // ç”±æ–¼è½‰ç›¤é †æ™‚é‡è½‰ï¼ŒæŒ‡é‡ç›¸å°æ–¼è½‰ç›¤æ˜¯é€†æ™‚é‡æƒéã€‚
            // index = (ç¸½é¸é …æ•¸ - (è½‰éçš„è§’åº¦ / æ¯å¡Šè§’åº¦)) % ç¸½é¸é …æ•¸
            let index = Math.floor((360 - degrees) / arcDeg) % options.length;
            
            // é¡¯ç¤ºçµæœ
            const winner = options[index];
            showResult(winner);
            
            // è½‰ç›¤å¢åŠ é«˜äº®ç‰¹æ•ˆ
            wheel.classList.add('winner-glow');
        }

        function showResult(text) {
            resultText.innerText = text;
            
            // é¡¯ç¤º Modal
            resultModal.classList.remove('hidden');
            // å¼·åˆ¶ Reflow è®“ opacity transition ç”Ÿæ•ˆ
            void resultModal.offsetWidth; 
            resultModal.classList.remove('opacity-0');
            resultCard.classList.remove('scale-90');
            resultCard.classList.add('scale-100', 'animate-pop');
        }

        function closeResult() {
            resultModal.classList.add('opacity-0');
            resultCard.classList.remove('scale-100');
            resultCard.classList.add('scale-90');
            
            setTimeout(() => {
                resultModal.classList.add('hidden');
                resultCard.classList.remove('animate-pop');
            }, 300);
        }

        // --- äº‹ä»¶ç›£è½ ---
        spinButton.addEventListener('click', spin);
        
        optionsInput.addEventListener('input', () => {
            if (!isSpinning) updateWheel();
        });

        closeModal.addEventListener('click', closeResult);
        
        // é»èƒŒæ™¯é—œé–‰
        resultModal.addEventListener('click', (e) => {
            if (e.target === resultModal) closeResult();
        });

        // åˆå§‹åŒ–
        updateWheel();

    </script>
</body>
</html>